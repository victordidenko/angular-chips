!function(){function e(e){return e&&angular.isFunction(e.then)}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(e){return{add:function(n){var t=angular.copy(e.$modelValue)||[];t.push(n),e.$setViewValue(t)},"delete":function(n){var t=angular.copy(e.$modelValue);t.splice(n,1),e.$setViewValue(t)},deleteByValue:function(n){var t,i;for(t=0;t<e.$modelValue.length;t++)if(angular.equals(e.$modelValue[t],n)){i=t;break}void 0!==i&&this["delete"](i)}}}function i(e,n){var t=this;this.type="defer",this.defer=e,this.isLoading=!1,this.isFailed=!1,n&&(t.isLoading=!0,n.then(function(e){t.defer=e,t.isLoading=!1},function(e){t.defer=e,t.isLoading=!1,t.isFailed=!0}))}function r(e){if(void 0!==e){var n,t;return n=e.indexOf("(")+1,t=e.indexOf(")"),e.substr(n,t-n)}}function o(o,c,a,u){function s(a,s,d,p,f){function h(e){return function(n){return 37===n?e--:e++,e=e<0?a.chips.list.length-1:e>a.chips.list.length-1?0:e}}if(""!==(error=l(s)))throw error;var v=t(p),m=d.hasOwnProperty("defer"),g=r(d.render);a.chips.list,a.chips.addChip=function(t){function r(e,t){for(var r=n(e)?e:[e],l=0;l<r.length;l++)a.chips.list.push(t?new i(r[l],o.when(r[l])):r[l]),v.add(r[l])}var l,c;return void 0!==a.render&&""!==g?(c={},c[g]=t,l=a.render(c)):l=t,!!l&&(e(l)?(l=l.then(function(e){if(null==e||n(e)&&!e.length)throw t;var i=n(e)?e:[e],o=i.shift();return r(i,!0),v.add(o),o}),a.chips.list.push(new i(t,l)),a.$apply()):r(l),!0)},a.chips.deleteChip=function(e){var n=a.chips.list.splice(e,1)[0];return n.isFailed?void a.$apply():void(n instanceof i?v.deleteByValue(n.defer):v["delete"](e))},p.$render=function(){if(m&&p.$modelValue){var e,n=[];for(e=0;e<p.$modelValue.length;e++)n.push(new i(p.$modelValue[e]));a.chips.list=n}else a.chips.list=angular.copy(p.$modelValue)||[]};var C=null,$=angular.element("<div></div>"),y=s.html();y=y.substr(y.indexOf("<chip-tmpl"),y.indexOf("</chip-tmpl>")-"</chip-tmpl>".length),s.find("chip-tmpl").remove();var k=angular.element(y);k.attr("ng-repeat","chip in chips.list track by $index"),k.attr("ng-class","{'chip-failed':chip.isFailed}"),k.attr("tabindex","-1"),k.attr("index","{{$index+1}}"),$.append(k);var V=c($)(a);s.prepend(V),s.on("click",function(e){"CHIPS"===e.target.nodeName&&s.find("input")[0].focus()}),s.find("input").on("focus",function(){C=null}),a.chips.handleKeyDown=function(e){function n(){var n=parseInt(document.activeElement.getAttribute("index"))||(t=s.find("chip-tmpl")).length;t=s.find("chip-tmpl"),t[n-1].focus(),C=h(n-1),"INPUT"!==e.target.nodeName&&t[C(e.keyCode)].focus()}if(!("INPUT"!==e.target.nodeName&&"CHIP-TMPL"!==e.target.nodeName||0===s.find("chip-tmpl").length&&""===e.target.value)){var t;if(8===e.keyCode){if("INPUT"===e.target.nodeName&&""===e.target.value)n(),e.preventDefault();else if("CHIP-TMPL"===e.target.nodeName){var i=s.find("chip-tmpl");i.length>0&&parseInt(e.target.getAttribute("index"))-1===i.length&&s.find("chip-tmpl")[C(37)].focus()}}else 37!==e.keyCode&&39!==e.keyCode||(null===C?n():s.find("chip-tmpl")[C(e.keyCode)].focus())}},s.on("keydown",a.chips.handleKeyDown),u(s).addClass("chip-out-focus")}return s.$inject=["scope","iElement","iAttrs","ngModelCtrl","transcludefn"],{restrict:"E",scope:{render:"&?"},transclude:!0,require:"ngModel",link:s,controller:"chipsController",controllerAs:"chips",template:"<div ng-transclude></div>"}}function l(e){return 0===e.find("chip-tmpl").length?"should have chip-tmpl":e.find("chip-tmpl").length>1?"should have only one chip-tmpl":""}function c(e,n,t){this.setFocus=function(e){e?t(n).removeClass("chip-out-focus").addClass("chip-in-focus"):t(n).removeClass("chip-in-focus").addClass("chip-out-focus")},this.removeChip=function(e,n){this.deleteChip(n)}}o.$inject=["$q","$compile","$timeout","DomUtil"],c.$inject=["$scope","$element","DomUtil"],angular.module("angular.chips",[]).directive("chips",o).controller("chipsController",c)}(),function(){function e(){return{restrict:"E",transclude:!0,link:function(e,n,t,i,r){r(e,function(e){n.append(e)}),n.on("keydown",function(n){8===n.keyCode&&(e.$broadcast("chip:delete"),n.preventDefault())})}}}angular.module("angular.chips").directive("chipTmpl",e)}(),function(){function e(){return{restrict:"A",require:"^?chips",link:function(e,n,t,i){function r(e,n){var t;if(n.search("\\(")>0&&(n=n.substr(0,n.search("\\("))),void 0!==n)if(n.split(".").length>1){var i=n.split(".");t=e;for(var r=0;r<i.length;r++)t=t[i[r]]}else t=e[n];return t}function o(e,n){var t=n.indexOf(".")!==-1?n.split(".")[0]:n.split("(")[0];return e.hasOwnProperty(t)?e:o(e.$parent,n)}function l(){if("string"==typeof e.chip||!e.chip.isLoading){var n,l=!0;t.hasOwnProperty("removeChip")&&""!==t.removeChip&&(n=r(o(e,t.removeChip),t.removeChip),l=n(e.chip)),l&&i.removeChip(e.chip,e.$index)}}n.on("click",function(){l()}),e.$on("chip:delete",function(){l()})}}}angular.module("angular.chips").directive("removeChip",e)}(),function(){function e(e){var n={};return n.addClass=function(t){return n.removeClass(e,t),e.attr("class",e.attr("class")+" "+t),n},n.removeClass=function(t){var i=e.attr("class").split(" "),r=i.indexOf(t);return r!==-1&&i.splice(r,1),e.attr("class",i.join(" ")),n},n}angular.module("angular.chips").factory("DomUtil",function(){return e})}(),function(){function e(){return{restrict:"A",require:"^chips",link:n}}function n(e,n,t,i){n.on("keypress",function(e){13===e.keyCode&&(""!==e.target.value&&i.addChip(e.target.value)&&(e.target.value=""),e.preventDefault())}),n.on("focus",function(){i.setFocus(!0)}),n.on("blur",function(){i.setFocus(!1)})}n.$inject=["scope","iElement","iAttrs","chipsCtrl"],angular.module("angular.chips").directive("chipControl",e)}(),function(){function e(){return{restrict:"A",require:["ngModel","^chips"],link:function(e,n,t,i){var r=i[0],o=i[1];r.$render=function(e){r.$modelValue&&o.addChip(r.$modelValue)&&n.val("")},n.on("focus",function(){o.setFocus(!0)}),n.on("blur",function(){o.setFocus(!1)})}}}angular.module("angular.chips").directive("ngModelControl",e)}();