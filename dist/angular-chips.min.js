!function(){function e(e){return e&&angular.isFunction(e.then)}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}function t(e){return{add:function(n){var t=angular.copy(e.$modelValue)||[];t.push(n),e.$setViewValue(t)},"delete":function(n){var t=angular.copy(e.$modelValue);t.splice(n,1),e.$setViewValue(t)},deleteByValue:function(n){var t,i;for(t=0;t<e.$modelValue.length;t++)if(angular.equals(e.$modelValue[t],n)){i=t;break}void 0!==i&&this["delete"](i)}}}function i(e,n){var t=this;this.type="defer",this.defer=e,this.isLoading=!1,this.isFailed=!1,n&&(t.isLoading=!0,n.then(function(e){t.defer=e,t.isLoading=!1},function(e){t.defer=e,t.isLoading=!1,t.isFailed=!0}))}function r(e){if(void 0!==e){var n,t;return n=e.indexOf("(")+1,t=e.indexOf(")"),e.substr(n,t-n)}}function o(o,c,u){function a(c,a,s,d,p){function f(e){return function(n){return 37===n?e--:e++,e=e<0?c.chips.list.length-1:e>c.chips.list.length-1?0:e}}if(""!==(error=l(a)))throw error;var h=t(d),m=s.hasOwnProperty("defer"),v=r(s.render);c.chips.list,c.chips.addChip=function(t){function r(e){for(var t=n(e)?e:[e],i=0;i<t.length;i++)c.chips.list.push(t[i]),h.add(t[i])}var o,l;return void 0!==c.render&&""!==v?(l={},l[v]=t,o=c.render(l)):o=t,!!o&&(e(o)?(o=o.then(function(e){if(null==e||n(e)&&!e.length)throw t;var i=n(e)?e:[e],o=i.shift();return r(i.map(function(e){return{defer:e}})),h.add(o),o}),c.chips.list.push(new i(t,o)),c.$apply()):r(o),!0)},c.chips.deleteChip=function(e){var n=c.chips.list.splice(e,1)[0];return n.isFailed?void c.$apply():void(n instanceof i?h.deleteByValue(n.defer):h["delete"](e))},d.$render=function(){if(m&&d.$modelValue){var e,n=[];for(e=0;e<d.$modelValue.length;e++)n.push(new i(d.$modelValue[e]));c.chips.list=n}else c.chips.list=angular.copy(d.$modelValue)||[]};var g=null,C=angular.element("<div></div>"),$=a.html();$=$.substr($.indexOf("<chip-tmpl"),$.indexOf("</chip-tmpl>")-"</chip-tmpl>".length),a.find("chip-tmpl").remove();var y=angular.element($);y.attr("ng-repeat","chip in chips.list track by $index"),y.attr("ng-class","{'chip-failed':chip.isFailed}"),y.attr("tabindex","-1"),y.attr("index","{{$index+1}}"),C.append(y);var k=o(C)(c);a.prepend(k),a.on("click",function(e){"CHIPS"===e.target.nodeName&&a.find("input")[0].focus()}),a.find("input").on("focus",function(){g=null}),c.chips.handleKeyDown=function(e){function n(){var n=parseInt(document.activeElement.getAttribute("index"))||(t=a.find("chip-tmpl")).length;t=a.find("chip-tmpl"),t[n-1].focus(),g=f(n-1),"INPUT"!==e.target.nodeName&&t[g(e.keyCode)].focus()}if(!("INPUT"!==e.target.nodeName&&"CHIP-TMPL"!==e.target.nodeName||0===a.find("chip-tmpl").length&&""===e.target.value)){var t;if(8===e.keyCode){if("INPUT"===e.target.nodeName&&""===e.target.value)n(),e.preventDefault();else if("CHIP-TMPL"===e.target.nodeName){var i=a.find("chip-tmpl");i.length>0&&parseInt(e.target.getAttribute("index"))-1===i.length&&a.find("chip-tmpl")[g(37)].focus()}}else 37!==e.keyCode&&39!==e.keyCode||(null===g?n():a.find("chip-tmpl")[g(e.keyCode)].focus())}},a.on("keydown",c.chips.handleKeyDown),u(a).addClass("chip-out-focus")}return a.$inject=["scope","iElement","iAttrs","ngModelCtrl","transcludefn"],{restrict:"E",scope:{render:"&?"},transclude:!0,require:"ngModel",link:a,controller:"chipsController",controllerAs:"chips",template:"<div ng-transclude></div>"}}function l(e){return 0===e.find("chip-tmpl").length?"should have chip-tmpl":e.find("chip-tmpl").length>1?"should have only one chip-tmpl":""}function c(e,n,t){this.setFocus=function(e){e?t(n).removeClass("chip-out-focus").addClass("chip-in-focus"):t(n).removeClass("chip-in-focus").addClass("chip-out-focus")},this.removeChip=function(e,n){this.deleteChip(n)}}o.$inject=["$compile","$timeout","DomUtil"],c.$inject=["$scope","$element","DomUtil"],angular.module("angular.chips",[]).directive("chips",o).controller("chipsController",c)}(),function(){function e(){return{restrict:"E",transclude:!0,link:function(e,n,t,i,r){r(e,function(e){n.append(e)}),n.on("keydown",function(n){8===n.keyCode&&(e.$broadcast("chip:delete"),n.preventDefault())})}}}angular.module("angular.chips").directive("chipTmpl",e)}(),function(){function e(){return{restrict:"A",require:"^?chips",link:function(e,n,t,i){function r(e,n){var t;if(n.search("\\(")>0&&(n=n.substr(0,n.search("\\("))),void 0!==n)if(n.split(".").length>1){var i=n.split(".");t=e;for(var r=0;r<i.length;r++)t=t[i[r]]}else t=e[n];return t}function o(e,n){var t=n.indexOf(".")!==-1?n.split(".")[0]:n.split("(")[0];return e.hasOwnProperty(t)?e:o(e.$parent,n)}function l(){if("string"==typeof e.chip||!e.chip.isLoading){var n,l=!0;t.hasOwnProperty("removeChip")&&""!==t.removeChip&&(n=r(o(e,t.removeChip),t.removeChip),l=n(e.chip)),l&&i.removeChip(e.chip,e.$index)}}n.on("click",function(){l()}),e.$on("chip:delete",function(){l()})}}}angular.module("angular.chips").directive("removeChip",e)}(),function(){function e(e){var n={};return n.addClass=function(t){return n.removeClass(e,t),e.attr("class",e.attr("class")+" "+t),n},n.removeClass=function(t){var i=e.attr("class").split(" "),r=i.indexOf(t);return r!==-1&&i.splice(r,1),e.attr("class",i.join(" ")),n},n}angular.module("angular.chips").factory("DomUtil",function(){return e})}(),function(){function e(){return{restrict:"A",require:"^chips",link:n}}function n(e,n,t,i){n.on("keypress",function(e){13===e.keyCode&&(""!==e.target.value&&i.addChip(e.target.value)&&(e.target.value=""),e.preventDefault())}),n.on("focus",function(){i.setFocus(!0)}),n.on("blur",function(){i.setFocus(!1)})}n.$inject=["scope","iElement","iAttrs","chipsCtrl"],angular.module("angular.chips").directive("chipControl",e)}(),function(){function e(){return{restrict:"A",require:["ngModel","^chips"],link:function(e,n,t,i){var r=i[0],o=i[1];r.$render=function(e){r.$modelValue&&o.addChip(r.$modelValue)&&n.val("")},n.on("focus",function(){o.setFocus(!0)}),n.on("blur",function(){o.setFocus(!1)})}}}angular.module("angular.chips").directive("ngModelControl",e)}();